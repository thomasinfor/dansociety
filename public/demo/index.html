<!DOCTYPE html>
<html>
<head>
  <title>DEMO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://vjs.zencdn.net/7.8.3/video-js.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
<style>
*{font-family: 'Open Sans', 'Noto Sans TC';}
body,html{height: 100%; color: black!important;scroll-behavior: smooth;}
body{width: 100%;margin: 0;padding: 0;}
/*#package{overflow-x: scroll;}*/
.page{width: 100%;height: 100vh;margin-bottom: 10vh;}
#discription{}
#video{position: relative;}
#take-picture{position: relative;}
#record{position: relative;}
#estimate{position: relative;}
#capture{display: none;}
.button{/*position: absolute;bottom: 8%;left: 50%;transform: translate(-50%,-50%);*/background-color: #ccc;padding: 15px 30px;border-radius: 10px;cursor: pointer;}
.button:hover{background-color: #aaa;}
.step{position: absolute;left: 10%;top: 5%;width: 80%;text-align: left;font-size: 40px;}
#camera{position: absolute;top: 50%;width: 45%;left: 75%;transform: translate(-50%,-50%) scale(-1, 1);}
#capture{transform: scale(-1, 1);width: 100%;}
#capture-block{position: absolute;top: 50%;width: 45%;left: 75%;transform: translate(-50%,-50%);}
#model{position: absolute;top: 50%;width: 45%;left: 25%;transform: translate(-50%,-50%);}
#video-input{position: absolute;top: 45%;width: 65%;left: 60%;transform: translate(-50%,-50%);max-height: 70%;max-width: 60%;}
#speed-control{position: absolute;bottom: 5%;left: 50%;transform: translate(-50%,-50%);}
#record > .button{position: absolute;bottom: 5%;left: 10%;}
#estimate > .button{position: absolute;top: 50%;left: 50%;transform: translate(-50%,-50%);}
/*@media only screen and (max-width: 800px){
  center{display :none;}
  #notice{display: block!important}
}*/
#take-picture > .button-block{position: absolute;bottom: 5%;left: 10%;}
.button-block > .button{margin-top: 20px;}
.d-none{display: none;}
#webcam-js,#snap-img{position: absolute;top: 50%;left: 60%;transform: translate(-50%,-50%) scale(-1, 1);max-height: 60%;max-width: 60%;}
#estimate{margin-bottom: 0!important;}
img.flip{-webkit-transform: scaleX(-1);transform: scaleX(-1);}
</style>
</head>
<body><center>
  <div id="package">
    <div class="page" id="description">
      <div class="step"></div>
    </div>
    <div class="page" id="take-picture">
      <div class="step">STEP 1</div>
      <video autoplay playsinline id="webcam-js" class="flip"></video>
      <canvas id="canvas" class="d-none"></canvas>
      <img id="snap-img"></img>
      <div class="button-block">
        <div class="button" id="snap-start" style="display: block;">TAKE A SNAPSHOT</div>
        <div class="button" id="snap-retry" style="display: none;">RETRY</div>
        <div class="button" id="snap-done" style="display: none;">DONE</div>
      </div>
      <script src="webcam.js"></script>
    </div>
    <div class="page" id="video">
      <div class="step">STEP 2</div>
      <video id="video-input" src="./demo-video.mp4" controls>
        <!-- <source src="./dance.mp4" type="video/mp4"> -->
        Your browser does not support the video tag.
      </video>
      <div id="speed-control">
        <input id="speed-slide" type="range" min="10" max="100" value="100">
        <div>playback speed: <span id="speed">1.00</span>x</div>
      </div>
    </div>
    <div class="page" id="record">
      <div class="step">STEP 3</div>
      <video id="model" src="./demo-video.mp4" style="display: block;"></video>
      <video id="camera" style="display: block;" class="flip"></video>
      <div id="capture-block" style="display: none;">
        <video id="capture" class="flip" style="display: block;"></video>
      </div>
      <div class="button" id="btnStart" style="display: block">START</div>
      <div class="button" id="btnStop" style="display: none;">STOP</div>
      <div class="button" id="btnAgain" style="display: none;">RETRY</div>
      <script src="./camera.js"></script>
    </div>
    <div class="page" id="estimate">
      <div class="step">STEP 4</div>
      <div class="button" onclick="estimate();">evaluate</div>
      <div id="score"></div>
    </div>
  </div>
  <script>
    function estimate(){
      const net = posenet.load({
        architecture: 'ResNet50',
        outputStride: 32,
        inputResolution: { width: 257, height: 200 },
        quantBytes: 2
      }).then((net)=>{
        const pose1 = net.estimateSinglePose(document.getElementById('video-input'),{
          flipHorizontal: true
        });
        const pose2 = net.estimateSinglePose(document.getElementById('capture'),{
          flipHorizontal: true
        });
        return compare(pose1,pose2);
      }).then((pose)=>{
        document.getElementById('score').innerHTML=pose;
      })
    }
    const speed=document.getElementById('speed');
    const videoinput=document.getElementById('video-input');
    document.getElementById('speed-slide').oninput=function(){
      speed.innerHTML=String(parseFloat(this.value/100).toFixed(2));
      videoinput.playbackRate=this.value/100;
    }
  </script>
</center>
<h1 id="notice" style="display: none;text-align: center;">! Not Available on Phone yet !</h1>
</body>
</html>